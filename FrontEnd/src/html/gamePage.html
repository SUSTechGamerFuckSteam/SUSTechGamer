<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="../css/gamePage.css" />
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script rel="text/javascript" src="../script/ServerInteraction.js"></script>
</head>

<body>
    <div id="vueDiv" v-cloak>
        <div id="headerDiv">
            <a style="margin-left: 20px;">first | </a>
            <a>first ad| </a>
            <a>first | </a>
            <a>first | </a>
            <a style="margin-left: 1170px;">sign-in</a>
            <a>sign-up</a>
        </div>
        <div style="height:100px;"></div>
        <div id="gameDetailDiv">
            <div id="gameVideoDiv">
                <video width="100%" controls autoplay>
                        <source src="../Video/OYH.mp4" type="video/mp4">   
                        您的浏览器不支持 video 属性。
                      </video>
            </div>
            <div id="gameGetDiv">
                <div id="priceDiv">
                    <p style="font-size: 45px;height:70px;width:200px;margin: 0 auto;">{{'$'+price}}</p>
                    <span style="font-size: 12px;">{{discount}}</span>
                </div>
                <a v-on:click.prevent="purchaseGame" class="button" href="#" style="width:180px;height:60px;margin: 20px auto;font-size: 30px;font-weight: bold; line-height: 60px;">Purchase</a>
                <a class="button" href="#downloadBranch" style="width:180px;height:60px;margin: 20px auto;font-size: 30px;font-weight: bold; line-height: 60px;">Download</a>
            </div>
            <textarea id="gameDescription" style="resize: none;width:90%;height:150px;">{{gameDescription}}</textarea>
        </div>
        <div id="gamePictureDiv" style="position: relative;">
            <p id="downloadBranch" class="clasify">
                <span id="reminder">Screenshots</span>
            </p>
            <div class="inlineDiv" style="margin-left: 0px;"></div>
            <div class="inlineDiv"></div>
            <div class="inlineDiv"></div>
            <div class="inlineDiv" style="width:30px;height:20px;margin-left: 1000px;text-align: center;">
                <a v-on:click.prevent="" class="button" href="#" style="margin: 0px;">&lt</a>
            </div>
            <div class="inlineDiv" style="width:30px;height:20px;margin-left: 30px;text-align: center;">
                <a v-on:click.prevent="" class="button" href="#" style="margin: 0px;">&gt</a>
            </div>


            <p class="clasify">
                <span id="reminder">Branches</span>
            </p>
            <div class="branchDiv" v-for="(branch,index) in branches" v-if="(index>=branchIndex&&index<branchIndex+3)?true:false">
                <textarea class="branchInfo" resizable="false">{{branch.info}}</textarea>
                <a v-on:click.prevent="" class="button" href="#" style="margin: 45px 20px;width:110px;float: left;display: inline-block;">download</a>
            </div>
            <!-- <div class="branchDiv">
                <textarea class="branchInfo" resizable="false">{{test}}</textarea>
                <a v-on:click.prevent="" class="button" href="#" style="margin: 45px 20px;width:110px;float: left;display: inline-block;">download</a>
            </div>
            <div class="branchDiv">
                <textarea class="branchInfo" resizable="false">{{test}}</textarea>
                <a v-on:click.prevent="" class="button" href="#" style="margin: 45px 20px;width:110px;float: left;display: inline-block;">download</a>
            </div> -->
            <div class="inlineDiv" style="width:30px;height:20px;margin-left: 1000px;text-align: center;">
                <a v-on:click.prevent="prevBranch" class="button" href="#" style="margin: 0px;">&lt</a>
            </div>
            <div class="inlineDiv" style="width:30px;height:20px;margin-left: 30px;text-align: center;">
                <a v-on:click.prevent="nextBranch" class="button" href="#" style="margin: 0px;">&gt</a>
            </div>

            <p class="clasify">
                <span id="reminder">DLCs</span>
            </p>
            <div class="branchDiv">
                <textarea class="branchInfo" resizable="false">{{test}}</textarea>
                <div style="float: left;width:110px;height:25px;font-size: 20px;text-align: center;">$120</div>
                <a v-on:click.prevent="" class="button" href="#" style="margin: 5px 20px;width:110px;float: left;display: inline-block;font-size: 20px;">purchase</a>
                <a v-on:click.prevent="" class="button" href="#" style="margin: 0px 20px;width:110px;float: left;display: inline-block;font-size: 18px;">download</a>
            </div>
            <div class="branchDiv">
                <textarea class="branchInfo" resizable="false">{{test}}</textarea>
                <a v-on:click.prevent="" class="button" href="#" style="margin: 45px 20px;width:110px;float: left;display: inline-block;">download</a>
            </div>
            <div class="branchDiv">
                <textarea class="branchInfo" resizable="false">{{test}}</textarea>
                <a v-on:click.prevent="" class="button" href="#" style="margin: 45px 20px;width:110px;float: left;display: inline-block;">download</a>
            </div>
            <div class="inlineDiv" style="width:30px;height:20px;margin-left: 1000px;text-align: center;">
                <a v-on:click.prevent="" class="button" href="#" style="margin: 0px;">&lt</a>
            </div>
            <div class="inlineDiv" style="width:30px;height:20px;margin-left: 30px;text-align: center;">
                <a v-on:click.prevent="" class="button" href="#" style="margin: 0px;">&gt</a>
            </div>

        </div>

        <div id="gameCommentDiv">
            <p class="clasify">
                <span id="reminder">Comments</span>
            </p>
            <div id="scoreDiv">
                <div style="width: 150px;height:100px;display:inline-block;font-size: 70px;margin-left: 70px;margin-top: 25px;text-align: center;">
                    4.5
                </div>
                <span style="font-family: 微软雅黑, 宋体, Arial, Helvetica, Verdana, sans-serif;font-weight: lighter;font-size: 25px;">
                    points ranked by users
                </span>
            </div>
            <div class="userCommentDiv">
                this is a comment by user 11
            </div>
            <div class="userCommentDiv">
                this is a comment by user 12
            </div>
            <div class="userCommentDiv">
                this is a comment by user 13
            </div>
            <div class="inlineDiv" style="width:30px;height:20px;margin-left: 1000px;text-align: center;">
                <a v-on:click.prevent="prevBranch" class="button" href="#" style="margin: 0px;">&lt</a>
            </div>
            <div class="inlineDiv" style="width:30px;height:20px;margin-left: 30px;text-align: center;">
                <a v-on:click.prevent="nextBranch" class="button" href="#" style="margin: 0px;">&gt</a>
            </div>

        </div>
    </div>
</body>
<script>
    var vm = new Vue({
        el: '#vueDiv',
        data: {
            userBalance: 120,
            test: "hh\nnima\nhh",
            gameVideoUrl: "",
            price: "520",
            gameDescription: "this is the best game in SUSTech\nLOL!!!!!",
            screenshotsUrl: "",
            branches: [{
                info: "asasaas"
            }, {
                info: "dadsdada"
            }, {
                info: "dadadadadad"
            }, {
                info: "x"
            }, ],
            DLCs: "",
            branchIndex: 0,
            discount: "(discount 87%, original $600)",
            uid: 1,
            gid: 6,
        },
        created: function() {
            outThis = this
            ajax("get", "http://10.21.100.129:9090/game/findPriceByGid?gid=6", null, true, function(x) {
                outThis.price = x.responseText
            })
            ajax("get", "http://10.21.100.129:9090/user/findBalanceByUid?uid=" + this.uid, null, true, function(x) {
                outThis.userBalance = x.responseText
            })
        },
        methods: {
            nextBranch: function() {
                this.branchIndex += 3
            },
            prevBranch: function() {
                this.branchIndex -= 3
            },
            purchaseGame: function() {
                var purchasable = false
                ajax("get", "http://10.21.100.129:9090/dev_game/findBygidByuid?gid=" + this.gid + "&uid=" + this.uid, null, false, function(x) {
                    if (x.responseText == 0) {
                        purchasable = true
                    }
                })
                if (!purchasable) {
                    alert("you have purchased already")
                    return
                }
                if (this.userBalance < this.price) {
                    alert("your balance is not enough")
                    return
                }
                ajax("get", "http://10.21.100.129:9090/dev_game/buyByuidBygid?uid=" + this.uid + "&gid=" + this.gid, null, false, function(x) {
                    if (x.responseText == 1) {
                        alert("purchase successfully")
                    } else {
                        alert("purchase failed")
                    }

                })
                location.reload()
            },
            purchaseDLC: function() {

            }
        }
    })
</script>

</html>